<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n tr·ªã - Thanh ni√™n s·ªë M√≥ng C√°i 1</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'vietnam': ['"Be Vietnam Pro"', 'sans-serif'],
                    },
                    colors: {
                        'primary': {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        'admin': {
                            bg: '#0f172a',
                            sidebar: '#1e293b',
                            card: '#334155',
                            accent: '#3b82f6',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        
        .admin-gradient {
            background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 50%, #1e293b 100%);
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), transparent);
            border-left: 3px solid #3b82f6;
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
        
        .table-row:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* Fix select dropdown styling */
        select.input-field {
            background-color: #1e293b;
            color: white;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }
        
        select.input-field option {
            background-color: #1e293b;
            color: white;
            padding: 10px;
        }
        
        select.input-field option:hover,
        select.input-field option:focus,
        select.input-field option:checked {
            background-color: #3b82f6;
            color: white;
        }
        
        /* Leaflet Map Styles for Admin */
        .leaflet-container {
            border-radius: 8px;
            z-index: 1;
            background: #1e293b;
        }
        
        .leaflet-control-attribution {
            font-size: 10px;
            background: rgba(30, 41, 59, 0.8) !important;
            color: #94a3b8 !important;
        }
        
        .leaflet-control-attribution a {
            color: #60a5fa !important;
        }
        
        .leaflet-control-zoom a {
            background: #1e293b !important;
            color: white !important;
            border-color: #334155 !important;
        }
        
        .leaflet-control-zoom a:hover {
            background: #334155 !important;
        }
        
        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body class="admin-gradient min-h-screen">
    <div id="root"></div>
    
    <!-- Leaflet JS for Map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        const API_BASE_URL = '/api';
        
        // ===================== ICONS =====================
        const Icon = ({ name, size = 20, className = "" }) => {
            const ref = React.useRef(null);
            useEffect(() => {
                if (ref.current) {
                    ref.current.innerHTML = '';
                    const icon = lucide.createElement(lucide.icons[name]);
                    if (icon) {
                        icon.setAttribute('width', size);
                        icon.setAttribute('height', size);
                        ref.current.appendChild(icon);
                    }
                }
            }, [name, size]);
            return <span ref={ref} className={`inline-flex items-center justify-center ${className}`} />;
        };
        
        // ===================== LOGIN PAGE =====================
        const LoginPage = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                
                try {
                    const response = await fetch(`${API_BASE_URL}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        localStorage.setItem('user', JSON.stringify(data.user));
                        onLogin(data.user);
                    } else {
                        setError(data.message || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');
                    }
                } catch (err) {
                    setError('L·ªói k·∫øt n·ªëi server');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="w-full max-w-md">
                        {/* Logo & Header */}
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-2xl flex items-center justify-center shadow-lg">
                                <Icon name="Shield" size={40} className="text-white" />
                            </div>
                            <h1 className="text-2xl font-bold text-white mb-2">Qu·∫£n tr·ªã h·ªá th·ªëng</h1>
                            <p className="text-gray-400">Thanh ni√™n s·ªë M√≥ng C√°i 1</p>
                        </div>
                        
                        {/* Login Form */}
                        <form onSubmit={handleSubmit} className="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-8 border border-slate-700/50 shadow-2xl">
                            {error && (
                                <div className="mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm flex items-center gap-2">
                                    <Icon name="AlertCircle" size={18} />
                                    {error}
                                </div>
                            )}
                            
                            <div className="mb-5">
                                <label className="block text-gray-300 text-sm font-medium mb-2">
                                    T√™n ƒëƒÉng nh·∫≠p
                                </label>
                                <div className="relative">
                                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                        <Icon name="User" size={18} />
                                    </span>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="input-field w-full pl-10 pr-4 py-3 rounded-lg text-white"
                                        placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
                                        required
                                    />
                                </div>
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-gray-300 text-sm font-medium mb-2">
                                    M·∫≠t kh·∫©u
                                </label>
                                <div className="relative">
                                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                        <Icon name="Lock" size={18} />
                                    </span>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="input-field w-full pl-10 pr-4 py-3 rounded-lg text-white"
                                        placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                                        required
                                    />
                                </div>
                            </div>
                            
                            <button
                                type="submit"
                                disabled={loading}
                                className="btn-primary w-full py-3 rounded-lg text-white font-semibold flex items-center justify-center gap-2 disabled:opacity-50"
                            >
                                {loading ? (
                                    <>
                                        <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                                        ƒêang ƒëƒÉng nh·∫≠p...
                                    </>
                                ) : (
                                    <>
                                        <Icon name="LogIn" size={18} />
                                        ƒêƒÉng nh·∫≠p
                                    </>
                                )}
                            </button>
                            
                            <div className="mt-6 text-center">
                                <a href="/" className="text-blue-400 hover:text-blue-300 text-sm flex items-center justify-center gap-1">
                                    <Icon name="ArrowLeft" size={16} />
                                    Quay v·ªÅ trang ch·ªß
                                </a>
                            </div>
                        </form>
                        
                        {/* Demo credentials */}
                        <div className="mt-6 p-4 bg-slate-800/30 rounded-xl border border-slate-700/30">
                            <p className="text-gray-400 text-xs text-center mb-2">T√†i kho·∫£n m·∫´u:</p>
                            <div className="flex justify-center gap-4 text-xs">
                                <span className="text-gray-300">admin / admin123</span>
                                <span className="text-gray-500">|</span>
                                <span className="text-gray-300">editor / editor123</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // ===================== SIDEBAR =====================
        const Sidebar = ({ currentPage, onNavigate, user, onLogout }) => {
            const menuItems = [
                { id: 'dashboard', label: 'T·ªïng quan', icon: 'LayoutDashboard' },
                { id: 'posts', label: 'Qu·∫£n l√Ω b√†i vi·∫øt', icon: 'FileText' },
                { id: 'locations', label: 'Qu·∫£n l√Ω ƒë·ªãa ƒëi·ªÉm', icon: 'MapPin' },
            ];
            
            // Only show user management for SUPER_ADMIN
            if (user?.role === 'SUPER_ADMIN') {
                menuItems.push({ id: 'users', label: 'Qu·∫£n l√Ω t√†i kho·∫£n', icon: 'Users' });
            }
            
            return (
                <div className="w-64 bg-slate-900/50 backdrop-blur-xl border-r border-slate-700/50 flex flex-col h-screen fixed left-0 top-0">
                    {/* Logo */}
                    <div className="p-5 border-b border-slate-700/50">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-xl flex items-center justify-center">
                                <Icon name="Shield" size={22} className="text-white" />
                            </div>
                            <div>
                                <h1 className="text-white font-bold">Admin Panel</h1>
                                <p className="text-gray-400 text-xs">M√≥ng C√°i 1</p>
                            </div>
                        </div>
                    </div>
                    
                    {/* Menu */}
                    <nav className="flex-1 p-4">
                        <div className="space-y-1">
                            {menuItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => onNavigate(item.id)}
                                    className={`sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-all ${
                                        currentPage === item.id 
                                            ? 'active text-blue-400' 
                                            : 'text-gray-400 hover:text-white'
                                    }`}
                                >
                                    <Icon name={item.icon} size={20} />
                                    <span className="font-medium">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                    
                    {/* User Info */}
                    <div className="p-4 border-t border-slate-700/50">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-400 rounded-full flex items-center justify-center">
                                <span className="text-white font-bold text-sm">
                                    {user?.fullName?.charAt(0) || user?.username?.charAt(0) || 'U'}
                                </span>
                            </div>
                            <div className="flex-1 min-w-0">
                                <p className="text-white font-medium text-sm truncate">
                                    {user?.fullName || user?.username}
                                </p>
                                <p className="text-gray-400 text-xs">{user?.role}</p>
                            </div>
                        </div>
                        <button
                            onClick={onLogout}
                            className="w-full flex items-center justify-center gap-2 py-2 px-4 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-all text-sm"
                        >
                            <Icon name="LogOut" size={16} />
                            ƒêƒÉng xu·∫•t
                        </button>
                    </div>
                </div>
            );
        };
        
        // ===================== DASHBOARD PAGE =====================
        const DashboardPage = ({ user }) => {
            const [stats, setStats] = useState({
                posts: 0,
                locations: 0,
                users: 0,
                views: 0
            });
            const [recentPosts, setRecentPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                const fetchData = async () => {
                    try {
                        const [postsRes, locationsRes] = await Promise.all([
                            fetch(`${API_BASE_URL}/posts?size=5`),
                            fetch(`${API_BASE_URL}/locations/simple`)
                        ]);
                        
                        const postsData = await postsRes.json();
                        const locationsData = await locationsRes.json();
                        
                        setStats({
                            posts: postsData.totalElements || postsData.length || 0,
                            locations: locationsData.length || 0,
                            users: 2,
                            views: (postsData.content || postsData).reduce((sum, p) => sum + (p.viewCount || 0), 0)
                        });
                        
                        setRecentPosts((postsData.content || postsData).slice(0, 5));
                    } catch (err) {
                        console.error('Error fetching stats:', err);
                    } finally {
                        setLoading(false);
                    }
                };
                
                fetchData();
            }, []);
            
            const statCards = [
                { label: 'B√†i vi·∫øt', value: stats.posts, icon: 'FileText', color: 'from-blue-500 to-cyan-400' },
                { label: 'ƒê·ªãa ƒëi·ªÉm', value: stats.locations, icon: 'MapPin', color: 'from-green-500 to-emerald-400' },
                { label: 'T√†i kho·∫£n', value: stats.users, icon: 'Users', color: 'from-purple-500 to-pink-400' },
                { label: 'L∆∞·ª£t xem', value: stats.views, icon: 'Eye', color: 'from-orange-500 to-yellow-400' },
            ];
            
            return (
                <div className="animate-slide-in">
                    <div className="mb-8">
                        <h1 className="text-2xl font-bold text-white mb-2">
                            Xin ch√†o, {user?.fullName || user?.username}! üëã
                        </h1>
                        <p className="text-gray-400">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi trang qu·∫£n tr·ªã M√≥ng C√°i 1</p>
                    </div>
                    
                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                        {statCards.map((stat, idx) => (
                            <div key={idx} className="bg-slate-800/50 backdrop-blur rounded-xl p-5 border border-slate-700/50">
                                <div className="flex items-center justify-between mb-4">
                                    <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${stat.color} flex items-center justify-center`}>
                                        <Icon name={stat.icon} size={24} className="text-white" />
                                    </div>
                                </div>
                                <p className="text-3xl font-bold text-white mb-1">
                                    {loading ? '...' : stat.value.toLocaleString()}
                                </p>
                                <p className="text-gray-400 text-sm">{stat.label}</p>
                            </div>
                        ))}
                    </div>
                    
                    {/* Recent Posts */}
                    <div className="bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50">
                        <div className="p-5 border-b border-slate-700/50">
                            <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                <Icon name="Clock" size={20} />
                                B√†i vi·∫øt g·∫ßn ƒë√¢y
                            </h2>
                        </div>
                        <div className="p-5">
                            {loading ? (
                                <div className="text-gray-400 text-center py-8">ƒêang t·∫£i...</div>
                            ) : recentPosts.length === 0 ? (
                                <div className="text-gray-400 text-center py-8">Ch∆∞a c√≥ b√†i vi·∫øt n√†o</div>
                            ) : (
                                <div className="space-y-3">
                                    {recentPosts.map((post, idx) => (
                                        <div key={idx} className="flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/30 transition-colors">
                                            <div className="flex-1 min-w-0">
                                                <h3 className="text-white font-medium truncate">{post.title}</h3>
                                                <p className="text-gray-400 text-sm">{post.author} ‚Ä¢ {post.category?.name || 'Ch∆∞a ph√¢n lo·∫°i'}</p>
                                            </div>
                                            <div className="flex items-center gap-2 text-gray-400 text-sm">
                                                <Icon name="Eye" size={14} />
                                                {post.viewCount || 0}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // ===================== IMAGE UPLOAD COMPONENT =====================
        const ImageUpload = ({ value, onChange, label = "·∫¢nh" }) => {
            const [uploading, setUploading] = useState(false);
            const [error, setError] = useState(null);
            const [preview, setPreview] = useState(value || '');
            const fileInputRef = React.useRef(null);
            
            React.useEffect(() => {
                setPreview(value || '');
            }, [value]);
            
            const handleFileSelect = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validate file type
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                if (!allowedTypes.includes(file.type)) {
                    setError('Ch·ªâ ch·∫•p nh·∫≠n file ·∫£nh (jpg, png, gif, webp)');
                    return;
                }
                
                // Validate file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    setError('K√≠ch th∆∞·ªõc file t·ªëi ƒëa l√† 5MB');
                    return;
                }
                
                setError(null);
                setUploading(true);
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const response = await fetch(`${API_BASE_URL}/upload/image`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok && result.url) {
                        setPreview(result.url);
                        onChange(result.url);
                    } else {
                        setError(result.error || 'L·ªói khi upload ·∫£nh');
                    }
                } catch (err) {
                    console.error('Upload error:', err);
                    setError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server');
                } finally {
                    setUploading(false);
                }
            };
            
            const handleRemove = () => {
                setPreview('');
                onChange('');
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };
            
            const handleUrlInput = (e) => {
                const url = e.target.value;
                setPreview(url);
                onChange(url);
            };
            
            return (
                <div className="space-y-3">
                    <label className="block text-gray-300 text-sm font-medium">{label}</label>
                    
                    {/* Preview */}
                    {preview ? (
                        <div className="relative group">
                            <img 
                                src={preview} 
                                alt="Preview" 
                                className="w-full h-48 object-cover rounded-lg border border-slate-600"
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                    setError('Kh√¥ng th·ªÉ t·∫£i ·∫£nh t·ª´ URL n√†y');
                                }}
                            />
                            <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center gap-3">
                                <button
                                    type="button"
                                    onClick={() => fileInputRef.current?.click()}
                                    className="px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm flex items-center gap-2"
                                >
                                    <Icon name="RefreshCw" size={14} />
                                    ƒê·ªïi ·∫£nh
                                </button>
                                <button
                                    type="button"
                                    onClick={handleRemove}
                                    className="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm flex items-center gap-2"
                                >
                                    <Icon name="Trash2" size={14} />
                                    X√≥a
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div 
                            onClick={() => !uploading && fileInputRef.current?.click()}
                            className={`border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500/50 hover:bg-slate-700/30 transition-all ${uploading ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                            {uploading ? (
                                <div className="flex flex-col items-center">
                                    <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"></div>
                                    <p className="text-gray-400 text-sm">ƒêang t·∫£i l√™n...</p>
                                </div>
                            ) : (
                                <>
                                    <Icon name="ImagePlus" size={36} className="mx-auto mb-3 text-gray-500" />
                                    <p className="text-gray-400 text-sm mb-1">Click ƒë·ªÉ ch·ªçn ·∫£nh</p>
                                    <p className="text-gray-500 text-xs">JPG, PNG, GIF, WEBP (T·ªëi ƒëa 5MB)</p>
                                </>
                            )}
                        </div>
                    )}
                    
                    {/* Hidden file input */}
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                        onChange={handleFileSelect}
                        className="hidden"
                    />
                    
                    {/* URL Input option */}
                    <div className="flex items-center gap-2">
                        <span className="text-gray-500 text-xs">ho·∫∑c</span>
                        <input
                            type="text"
                            value={preview}
                            onChange={handleUrlInput}
                            placeholder="Nh·∫≠p URL ·∫£nh..."
                            className="input-field flex-1 px-3 py-2 rounded-lg text-white text-sm"
                        />
                    </div>
                    
                    {/* Error message */}
                    {error && (
                        <div className="flex items-center gap-2 text-red-400 text-sm">
                            <Icon name="AlertCircle" size={14} />
                            {error}
                        </div>
                    )}
                </div>
            );
        };
        
        // ===================== POSTS MANAGEMENT =====================
        const PostsPage = ({ user }) => {
            const [posts, setPosts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [editingPost, setEditingPost] = useState(null);
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                summary: '',
                categoryId: '',
                author: 'UBND Ph∆∞·ªùng M√≥ng C√°i 1',
                isFeatured: false,
                isUrgent: false,
                thumbnailUrl: ''
            });
            
            const fetchData = async () => {
                try {
                    const [postsRes, catsRes] = await Promise.all([
                        fetch(`${API_BASE_URL}/posts?size=100`),
                        fetch(`${API_BASE_URL}/categories/posts`)
                    ]);
                    
                    const postsData = await postsRes.json();
                    const catsData = await catsRes.json();
                    
                    setPosts(postsData.content || postsData);
                    setCategories(catsData);
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };
            
            useEffect(() => {
                fetchData();
            }, []);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                const url = editingPost 
                    ? `${API_BASE_URL}/posts/${editingPost.id}`
                    : `${API_BASE_URL}/posts`;
                    
                const method = editingPost ? 'PUT' : 'POST';
                
                try {
                    const response = await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        setShowModal(false);
                        setEditingPost(null);
                        setFormData({
                            title: '',
                            content: '',
                            summary: '',
                            categoryId: '',
                            author: 'UBND Ph∆∞·ªùng M√≥ng C√°i 1',
                            isFeatured: false,
                            isUrgent: false,
                            thumbnailUrl: ''
                        });
                        fetchData();
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            const handleEdit = (post) => {
                setEditingPost(post);
                setFormData({
                    title: post.title || '',
                    content: post.content || '',
                    summary: post.summary || '',
                    categoryId: post.category?.id || '',
                    author: post.author || 'UBND Ph∆∞·ªùng M√≥ng C√°i 1',
                    isFeatured: post.isFeatured || false,
                    isUrgent: post.isUrgent || false,
                    thumbnailUrl: post.thumbnailUrl || ''
                });
                setShowModal(true);
            };
            
            const handleDelete = async (id) => {
                if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i vi·∫øt n√†y?')) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/posts/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        fetchData();
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            return (
                <div className="animate-slide-in">
                    <div className="flex items-center justify-between mb-6">
                        <div>
                            <h1 className="text-2xl font-bold text-white mb-1">Qu·∫£n l√Ω b√†i vi·∫øt</h1>
                            <p className="text-gray-400 text-sm">T·∫°o, ch·ªânh s·ª≠a v√† qu·∫£n l√Ω c√°c b√†i vi·∫øt tin t·ª©c</p>
                        </div>
                        <button
                            onClick={() => {
                                setEditingPost(null);
                                setFormData({
                                    title: '',
                                    content: '',
                                    summary: '',
                                    categoryId: categories[0]?.id || '',
                                    author: 'UBND Ph∆∞·ªùng M√≥ng C√°i 1',
                                    isFeatured: false,
                                    isUrgent: false
                                });
                                setShowModal(true);
                            }}
                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium flex items-center gap-2"
                        >
                            <Icon name="Plus" size={18} />
                            Th√™m b√†i vi·∫øt
                        </button>
                    </div>
                    
                    {/* Posts Table */}
                    <div className="bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 overflow-hidden">
                        {loading ? (
                            <div className="text-gray-400 text-center py-12">ƒêang t·∫£i...</div>
                        ) : posts.length === 0 ? (
                            <div className="text-gray-400 text-center py-12">
                                <Icon name="FileX" size={48} className="mx-auto mb-4 opacity-50" />
                                <p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o</p>
                            </div>
                        ) : (
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b border-slate-700/50 text-left">
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">Ti√™u ƒë·ªÅ</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">Danh m·ª•c</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">T√°c gi·∫£</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-center">Tr·∫°ng th√°i</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-center">L∆∞·ª£t xem</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-right">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {posts.map((post, idx) => (
                                        <tr key={idx} className="table-row border-b border-slate-700/30">
                                            <td className="px-5 py-4">
                                                <div className="flex items-center gap-3">
                                                    {post.thumbnailUrl ? (
                                                        <img 
                                                            src={post.thumbnailUrl} 
                                                            alt="" 
                                                            className="w-12 h-12 rounded-lg object-cover flex-shrink-0"
                                                        />
                                                    ) : (
                                                        <div className="w-12 h-12 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0">
                                                            <Icon name="FileText" size={20} className="text-slate-500" />
                                                        </div>
                                                    )}
                                                    <div className="min-w-0 flex-1">
                                                        <p className="text-white font-medium truncate">{post.title}</p>
                                                        <p className="text-gray-400 text-sm truncate">{post.summary}</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-5 py-4">
                                                <span className="px-2 py-1 bg-blue-500/10 text-blue-400 rounded text-xs">
                                                    {post.category?.name || 'N/A'}
                                                </span>
                                            </td>
                                            <td className="px-5 py-4 text-gray-300 text-sm">{post.author}</td>
                                            <td className="px-5 py-4 text-center">
                                                <div className="flex items-center justify-center gap-1">
                                                    {post.isUrgent && (
                                                        <span className="px-2 py-0.5 bg-red-500/20 text-red-400 rounded text-xs">Kh·∫©n</span>
                                                    )}
                                                    {post.isFeatured && (
                                                        <span className="px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded text-xs">N·ªïi b·∫≠t</span>
                                                    )}
                                                </div>
                                            </td>
                                            <td className="px-5 py-4 text-center text-gray-300">{post.viewCount || 0}</td>
                                            <td className="px-5 py-4 text-right">
                                                <div className="flex items-center justify-end gap-2">
                                                    <button
                                                        onClick={() => handleEdit(post)}
                                                        className="p-2 hover:bg-blue-500/20 text-blue-400 rounded-lg transition-colors"
                                                    >
                                                        <Icon name="Edit2" size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(post.id)}
                                                        className="p-2 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors"
                                                    >
                                                        <Icon name="Trash2" size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>
                    
                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-slate-700">
                                <div className="p-6 border-b border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-white">
                                            {editingPost ? 'S·ª≠a b√†i vi·∫øt' : 'Th√™m b√†i vi·∫øt m·ªõi'}
                                        </h2>
                                        <button
                                            onClick={() => setShowModal(false)}
                                            className="p-2 hover:bg-slate-700 rounded-lg transition-colors text-gray-400"
                                        >
                                            <Icon name="X" size={20} />
                                        </button>
                                    </div>
                                </div>
                                
                                <form onSubmit={handleSubmit} className="p-6 space-y-5">
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">Ti√™u ƒë·ªÅ *</label>
                                        <input
                                            type="text"
                                            value={formData.title}
                                            onChange={(e) => setFormData({...formData, title: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-gray-300 text-sm font-medium mb-2">Danh m·ª•c *</label>
                                            <select
                                                value={formData.categoryId}
                                                onChange={(e) => setFormData({...formData, categoryId: e.target.value})}
                                                className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                required
                                            >
                                                <option value="" className="bg-slate-800 text-gray-400">-- Ch·ªçn danh m·ª•c --</option>
                                                {categories.map(cat => (
                                                    <option key={cat.id} value={cat.id} className="bg-slate-800 text-white">{cat.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-gray-300 text-sm font-medium mb-2">T√°c gi·∫£</label>
                                            <input
                                                type="text"
                                                value={formData.author}
                                                onChange={(e) => setFormData({...formData, author: e.target.value})}
                                                className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">T√≥m t·∫Øt</label>
                                        <textarea
                                            value={formData.summary}
                                            onChange={(e) => setFormData({...formData, summary: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            rows="2"
                                            placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn n·ªôi dung b√†i vi·∫øt"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">N·ªôi dung *</label>
                                        <textarea
                                            value={formData.content}
                                            onChange={(e) => setFormData({...formData, content: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            rows="6"
                                            placeholder="Nh·∫≠p n·ªôi dung b√†i vi·∫øt (h·ªó tr·ª£ HTML)"
                                            required
                                        />
                                    </div>
                                    
                                    {/* Image Upload */}
                                    <ImageUpload 
                                        value={formData.thumbnailUrl}
                                        onChange={(url) => setFormData({...formData, thumbnailUrl: url})}
                                        label="·∫¢nh ƒë·∫°i di·ªán b√†i vi·∫øt"
                                    />
                                    
                                    <div className="flex items-center gap-6">
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={formData.isFeatured}
                                                onChange={(e) => setFormData({...formData, isFeatured: e.target.checked})}
                                                className="w-4 h-4 rounded border-gray-500"
                                            />
                                            <span className="text-gray-300 text-sm">B√†i vi·∫øt n·ªïi b·∫≠t</span>
                                        </label>
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={formData.isUrgent}
                                                onChange={(e) => setFormData({...formData, isUrgent: e.target.checked})}
                                                className="w-4 h-4 rounded border-gray-500"
                                            />
                                            <span className="text-gray-300 text-sm">Tin kh·∫©n c·∫•p</span>
                                        </label>
                                    </div>
                                    
                                    <div className="flex justify-end gap-3 pt-4">
                                        <button
                                            type="button"
                                            onClick={() => setShowModal(false)}
                                            className="px-5 py-2.5 rounded-lg text-gray-300 hover:bg-slate-700 transition-colors"
                                        >
                                            H·ªßy
                                        </button>
                                        <button
                                            type="submit"
                                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium"
                                        >
                                            {editingPost ? 'C·∫≠p nh·∫≠t' : 'T·∫°o b√†i vi·∫øt'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ===================== LOCATION PICKER MAP COMPONENT =====================
        const LocationPickerMap = ({ coordinates, setCoordinates, onAddressFound }) => {
            const mapRef = React.useRef(null);
            const markerRef = React.useRef(null);
            const mapInstanceRef = React.useRef(null);

            // M√≥ng C√°i default center
            const defaultCenter = [21.5285, 107.9650];
            const defaultZoom = 15;

            React.useEffect(() => {
                // Initialize map only once
                if (!mapInstanceRef.current && mapRef.current) {
                    const map = L.map(mapRef.current).setView(
                        coordinates.lat && coordinates.lng 
                            ? [parseFloat(coordinates.lat), parseFloat(coordinates.lng)] 
                            : defaultCenter, 
                        defaultZoom
                    );

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(map);

                    // Custom marker icon
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="
                            background: #3b82f6;
                            width: 24px;
                            height: 24px;
                            border-radius: 50% 50% 50% 0;
                            transform: rotate(-45deg);
                            border: 3px solid white;
                            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                        "></div>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 24]
                    });

                    // Add initial marker if coordinates exist
                    if (coordinates.lat && coordinates.lng) {
                        markerRef.current = L.marker([parseFloat(coordinates.lat), parseFloat(coordinates.lng)], { icon: customIcon }).addTo(map);
                    }

                    // Click event to place marker
                    map.on('click', async (e) => {
                        const { lat, lng } = e.latlng;
                        
                        // Update or create marker
                        if (markerRef.current) {
                            markerRef.current.setLatLng([lat, lng]);
                        } else {
                            markerRef.current = L.marker([lat, lng], { icon: customIcon }).addTo(map);
                        }

                        setCoordinates({ lat: lat.toFixed(8), lng: lng.toFixed(8) });

                        // Reverse geocoding to get address
                        try {
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`,
                                { headers: { 'Accept-Language': 'vi' } }
                            );
                            const data = await response.json();
                            if (data.display_name && onAddressFound) {
                                onAddressFound(data.display_name);
                            }
                        } catch (err) {
                            console.error('Reverse geocoding error:', err);
                        }
                    });

                    mapInstanceRef.current = map;
                }

                return () => {
                    // Cleanup on unmount
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                };
            }, []);

            // Update marker when coordinates change externally
            React.useEffect(() => {
                if (mapInstanceRef.current && coordinates.lat && coordinates.lng) {
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="
                            background: #3b82f6;
                            width: 24px;
                            height: 24px;
                            border-radius: 50% 50% 50% 0;
                            transform: rotate(-45deg);
                            border: 3px solid white;
                            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                        "></div>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 24]
                    });

                    if (markerRef.current) {
                        markerRef.current.setLatLng([parseFloat(coordinates.lat), parseFloat(coordinates.lng)]);
                    } else {
                        markerRef.current = L.marker(
                            [parseFloat(coordinates.lat), parseFloat(coordinates.lng)], 
                            { icon: customIcon }
                        ).addTo(mapInstanceRef.current);
                    }
                    
                    mapInstanceRef.current.setView([parseFloat(coordinates.lat), parseFloat(coordinates.lng)], defaultZoom);
                }
            }, [coordinates.lat, coordinates.lng]);

            return (
                <div 
                    ref={mapRef} 
                    style={{ height: '280px', width: '100%', borderRadius: '8px' }}
                    className="border border-slate-600"
                />
            );
        };

        // ===================== ADDRESS SEARCH AUTOCOMPLETE COMPONENT =====================
        const AddressSearch = ({ onSelectAddress, onCoordinatesFound, initialValue = '' }) => {
            const [query, setQuery] = React.useState(initialValue);
            const [results, setResults] = React.useState([]);
            const [isSearching, setIsSearching] = React.useState(false);
            const [showDropdown, setShowDropdown] = React.useState(false);
            const searchTimeout = React.useRef(null);

            React.useEffect(() => {
                setQuery(initialValue);
            }, [initialValue]);

            const searchAddress = async (searchQuery) => {
                if (!searchQuery || searchQuery.length < 3) {
                    setResults([]);
                    return;
                }

                setIsSearching(true);
                try {
                    // Add M√≥ng C√°i to search for better local results
                    const searchWithContext = `${searchQuery}, M√≥ng C√°i, Qu·∫£ng Ninh, Vietnam`;
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchWithContext)}&limit=5&addressdetails=1`,
                        { headers: { 'Accept-Language': 'vi' } }
                    );
                    const data = await response.json();
                    setResults(data);
                    setShowDropdown(data.length > 0);
                } catch (err) {
                    console.error('Search error:', err);
                    setResults([]);
                } finally {
                    setIsSearching(false);
                }
            };

            const handleInputChange = (e) => {
                const value = e.target.value;
                setQuery(value);
                
                if (onSelectAddress) {
                    onSelectAddress(value);
                }

                // Debounce search
                if (searchTimeout.current) {
                    clearTimeout(searchTimeout.current);
                }
                searchTimeout.current = setTimeout(() => {
                    searchAddress(value);
                }, 500);
            };

            const handleSelectResult = (result) => {
                setQuery(result.display_name);
                setShowDropdown(false);
                
                if (onSelectAddress) {
                    onSelectAddress(result.display_name);
                }
                if (onCoordinatesFound) {
                    onCoordinatesFound({
                        lat: parseFloat(result.lat).toFixed(8),
                        lng: parseFloat(result.lon).toFixed(8)
                    });
                }
            };

            return (
                <div className="relative">
                    <div className="relative">
                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                            <Icon name="Search" size={18} />
                        </span>
                        <input
                            type="text"
                            value={query}
                            onChange={handleInputChange}
                            onFocus={() => results.length > 0 && setShowDropdown(true)}
                            placeholder="T√¨m ki·∫øm ƒë·ªãa ch·ªâ (VD: Ch·ª£ M√≥ng C√°i, UBND ph∆∞·ªùng...)"
                            className="input-field w-full pl-10 pr-10 py-3 rounded-lg text-white"
                        />
                        {isSearching && (
                            <div className="absolute right-3 top-1/2 -translate-y-1/2">
                                <div className="w-5 h-5 border-2 border-gray-400/30 border-t-gray-400 rounded-full animate-spin" />
                            </div>
                        )}
                    </div>

                    {showDropdown && results.length > 0 && (
                        <div className="absolute z-50 top-full left-0 right-0 mt-1 bg-slate-700 border border-slate-600 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                            {results.map((result, index) => (
                                <div
                                    key={index}
                                    className="px-4 py-3 hover:bg-slate-600 cursor-pointer border-b border-slate-600 last:border-0 transition-colors"
                                    onClick={() => handleSelectResult(result)}
                                >
                                    <div className="flex items-start gap-2">
                                        <span className="text-blue-400 mt-0.5 flex-shrink-0">
                                            <Icon name="MapPin" size={14} />
                                        </span>
                                        <div>
                                            <p className="text-white text-sm font-medium line-clamp-1">
                                                {result.display_name.split(',')[0]}
                                            </p>
                                            <p className="text-gray-400 text-xs line-clamp-1">
                                                {result.display_name}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // ===================== LOCATIONS MANAGEMENT =====================
        const LocationsPage = ({ user }) => {
            const [locations, setLocations] = useState([]);
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [editingLocation, setEditingLocation] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                address: '',
                description: '',
                categoryId: '',
                phone: '',
                email: '',
                website: '',
                openingHours: '',
                latitude: '',
                longitude: '',
                imageUrl: ''
            });
            
            const fetchData = async () => {
                try {
                    const [locsRes, catsRes] = await Promise.all([
                        fetch(`${API_BASE_URL}/locations/simple`),
                        fetch(`${API_BASE_URL}/categories/locations`)
                    ]);
                    
                    const locsData = await locsRes.json();
                    const catsData = await catsRes.json();
                    
                    setLocations(locsData);
                    setCategories(catsData);
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };
            
            useEffect(() => {
                fetchData();
            }, []);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                const url = editingLocation 
                    ? `${API_BASE_URL}/locations/${editingLocation.id}`
                    : `${API_BASE_URL}/locations`;
                    
                const method = editingLocation ? 'PUT' : 'POST';
                
                try {
                    const response = await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            ...formData,
                            latitude: formData.latitude ? parseFloat(formData.latitude) : null,
                            longitude: formData.longitude ? parseFloat(formData.longitude) : null
                        })
                    });
                    
                    if (response.ok) {
                        setShowModal(false);
                        setEditingLocation(null);
                        setFormData({
                            name: '',
                            address: '',
                            description: '',
                            categoryId: '',
                            phone: '',
                            email: '',
                            website: '',
                            openingHours: '',
                            latitude: '',
                            longitude: '',
                            imageUrl: ''
                        });
                        fetchData();
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            const handleEdit = (location) => {
                setEditingLocation(location);
                setFormData({
                    name: location.name || '',
                    address: location.address || '',
                    description: location.description || '',
                    categoryId: location.category?.id || '',
                    phone: location.phone || '',
                    email: location.email || '',
                    website: location.website || '',
                    openingHours: location.openingHours || '',
                    latitude: location.latitude || '',
                    longitude: location.longitude || '',
                    imageUrl: location.imageUrl || ''
                });
                setShowModal(true);
            };
            
            const handleDelete = async (id) => {
                if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë·ªãa ƒëi·ªÉm n√†y?')) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/locations/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        fetchData();
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            return (
                <div className="animate-slide-in">
                    <div className="flex items-center justify-between mb-6">
                        <div>
                            <h1 className="text-2xl font-bold text-white mb-1">Qu·∫£n l√Ω ƒë·ªãa ƒëi·ªÉm</h1>
                            <p className="text-gray-400 text-sm">Th√™m v√† ch·ªânh s·ª≠a th√¥ng tin c√°c ƒë·ªãa ƒëi·ªÉm quan tr·ªçng</p>
                        </div>
                        <button
                            onClick={() => {
                                setEditingLocation(null);
                                setFormData({
                                    name: '',
                                    address: '',
                                    description: '',
                                    categoryId: categories[0]?.id || '',
                                    phone: '',
                                    email: '',
                                    website: '',
                                    openingHours: '',
                                    latitude: '',
                                    longitude: '',
                                    imageUrl: ''
                                });
                                setShowModal(true);
                            }}
                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium flex items-center gap-2"
                        >
                            <Icon name="Plus" size={18} />
                            Th√™m ƒë·ªãa ƒëi·ªÉm
                        </button>
                    </div>
                    
                    {/* Locations Grid */}
                    {loading ? (
                        <div className="text-gray-400 text-center py-12">ƒêang t·∫£i...</div>
                    ) : locations.length === 0 ? (
                        <div className="bg-slate-800/50 rounded-xl p-12 text-center border border-slate-700/50">
                            <Icon name="MapPinOff" size={48} className="mx-auto mb-4 text-gray-500" />
                            <p className="text-gray-400">Ch∆∞a c√≥ ƒë·ªãa ƒëi·ªÉm n√†o</p>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                            {locations.map((location, idx) => (
                                <div key={idx} className="bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 overflow-hidden hover:border-blue-500/30 transition-colors">
                                    {/* Location Image */}
                                    {location.imageUrl ? (
                                        <div className="h-40 overflow-hidden">
                                            <img 
                                                src={location.imageUrl} 
                                                alt={location.name}
                                                className="w-full h-full object-cover"
                                            />
                                        </div>
                                    ) : (
                                        <div className="h-40 bg-slate-700/50 flex items-center justify-center">
                                            <Icon name="MapPin" size={40} className="text-slate-600" />
                                        </div>
                                    )}
                                    
                                    <div className="p-5">
                                        <div className="flex items-start justify-between mb-3">
                                            <div className="flex-1 min-w-0">
                                                <h3 className="text-white font-semibold truncate">{location.name}</h3>
                                                <span className="inline-block mt-1 px-2 py-0.5 bg-green-500/10 text-green-400 rounded text-xs">
                                                    {location.category?.name || 'N/A'}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div className="space-y-2 text-sm">
                                            <div className="flex items-start gap-2 text-gray-400">
                                                <Icon name="MapPin" size={14} className="mt-0.5 flex-shrink-0" />
                                                <span className="line-clamp-2">{location.address}</span>
                                            </div>
                                            {location.phone && (
                                                <div className="flex items-center gap-2 text-gray-400">
                                                    <Icon name="Phone" size={14} />
                                                    <span>{location.phone}</span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="px-5 py-3 bg-slate-900/50 border-t border-slate-700/30 flex justify-end gap-2">
                                        <button
                                            onClick={() => handleEdit(location)}
                                            className="px-3 py-1.5 text-sm text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors flex items-center gap-1"
                                        >
                                            <Icon name="Edit2" size={14} />
                                            S·ª≠a
                                        </button>
                                        <button
                                            onClick={() => handleDelete(location.id)}
                                            className="px-3 py-1.5 text-sm text-red-400 hover:bg-red-500/10 rounded-lg transition-colors flex items-center gap-1"
                                        >
                                            <Icon name="Trash2" size={14} />
                                            X√≥a
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-2xl w-full max-w-4xl max-h-[95vh] overflow-y-auto border border-slate-700">
                                <div className="p-6 border-b border-slate-700 sticky top-0 bg-slate-800 z-10">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-white">
                                            {editingLocation ? 'S·ª≠a ƒë·ªãa ƒëi·ªÉm' : 'Th√™m ƒë·ªãa ƒëi·ªÉm m·ªõi'}
                                        </h2>
                                        <button
                                            onClick={() => setShowModal(false)}
                                            className="p-2 hover:bg-slate-700 rounded-lg transition-colors text-gray-400"
                                        >
                                            <Icon name="X" size={20} />
                                        </button>
                                    </div>
                                </div>
                                
                                <form onSubmit={handleSubmit} className="p-6">
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        {/* Left Column - Basic Info */}
                                        <div className="space-y-5">
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">T√™n ƒë·ªãa ƒëi·ªÉm *</label>
                                                <input
                                                    type="text"
                                                    value={formData.name}
                                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    placeholder="VD: UBND Ph∆∞·ªùng M√≥ng C√°i 1"
                                                    required
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">Danh m·ª•c *</label>
                                                <select
                                                    value={formData.categoryId}
                                                    onChange={(e) => setFormData({...formData, categoryId: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    required
                                                >
                                                    <option value="" className="bg-slate-800 text-gray-400">-- Ch·ªçn danh m·ª•c --</option>
                                                    {categories.map(cat => (
                                                        <option key={cat.id} value={cat.id} className="bg-slate-800 text-white">{cat.name}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">M√¥ t·∫£</label>
                                                <textarea
                                                    value={formData.description}
                                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    rows="3"
                                                    placeholder="M√¥ t·∫£ v·ªÅ ƒë·ªãa ƒëi·ªÉm"
                                                />
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-gray-300 text-sm font-medium mb-2">S·ªë ƒëi·ªán tho·∫°i</label>
                                                    <input
                                                        type="text"
                                                        value={formData.phone}
                                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                                        className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                        placeholder="VD: 033-123-4567"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-300 text-sm font-medium mb-2">Email</label>
                                                    <input
                                                        type="email"
                                                        value={formData.email}
                                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                                        className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                        placeholder="email@example.com"
                                                    />
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">Gi·ªù m·ªü c·ª≠a</label>
                                                <input
                                                    type="text"
                                                    value={formData.openingHours}
                                                    onChange={(e) => setFormData({...formData, openingHours: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    placeholder="VD: Th·ª© 2 - Th·ª© 6: 7:30-17:00"
                                                />
                                            </div>
                                            
                                            {/* Image Upload */}
                                            <ImageUpload 
                                                value={formData.imageUrl}
                                                onChange={(url) => setFormData({...formData, imageUrl: url})}
                                                label="·∫¢nh ƒë·ªãa ƒëi·ªÉm"
                                            />
                                        </div>
                                        
                                        {/* Right Column - Map & Address */}
                                        <div className="space-y-5">
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">
                                                    <span className="flex items-center gap-2">
                                                        <Icon name="Search" size={16} />
                                                        T√¨m ki·∫øm ƒë·ªãa ch·ªâ
                                                    </span>
                                                </label>
                                                <AddressSearch 
                                                    initialValue={formData.address}
                                                    onSelectAddress={(addr) => setFormData({...formData, address: addr})}
                                                    onCoordinatesFound={(coords) => setFormData({
                                                        ...formData, 
                                                        latitude: coords.lat, 
                                                        longitude: coords.lng
                                                    })}
                                                />
                                                <p className="mt-1 text-gray-500 text-xs">Nh·∫≠p ƒë·ªãa ch·ªâ ƒë·ªÉ t√¨m ki·∫øm ho·∫∑c click v√†o b·∫£n ƒë·ªì</p>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">
                                                    <span className="flex items-center gap-2">
                                                        <Icon name="Map" size={16} />
                                                        Ch·ªçn v·ªã tr√≠ tr√™n b·∫£n ƒë·ªì
                                                    </span>
                                                </label>
                                                <LocationPickerMap 
                                                    coordinates={{ lat: formData.latitude, lng: formData.longitude }}
                                                    setCoordinates={(coords) => setFormData({
                                                        ...formData, 
                                                        latitude: coords.lat, 
                                                        longitude: coords.lng
                                                    })}
                                                    onAddressFound={(addr) => setFormData({...formData, address: addr})}
                                                />
                                                <p className="mt-1 text-gray-500 text-xs">Click v√†o b·∫£n ƒë·ªì ƒë·ªÉ ch·ªçn v·ªã tr√≠ ch√≠nh x√°c</p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-gray-300 text-sm font-medium mb-2">Vƒ© ƒë·ªô (Lat)</label>
                                                    <input
                                                        type="number"
                                                        step="any"
                                                        value={formData.latitude}
                                                        onChange={(e) => setFormData({...formData, latitude: e.target.value})}
                                                        className="input-field w-full px-4 py-3 rounded-lg text-white text-sm"
                                                        placeholder="21.5285"
                                                        readOnly
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-300 text-sm font-medium mb-2">Kinh ƒë·ªô (Lng)</label>
                                                    <input
                                                        type="number"
                                                        step="any"
                                                        value={formData.longitude}
                                                        onChange={(e) => setFormData({...formData, longitude: e.target.value})}
                                                        className="input-field w-full px-4 py-3 rounded-lg text-white text-sm"
                                                        placeholder="107.9650"
                                                        readOnly
                                                    />
                                                </div>
                                            </div>
                                            
                                            {/* Display selected address */}
                                            {formData.address && (
                                                <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                    <div className="flex items-start gap-2">
                                                        <Icon name="MapPin" size={16} className="text-blue-400 mt-0.5 flex-shrink-0" />
                                                        <div>
                                                            <p className="text-blue-400 text-xs font-medium mb-1">ƒê·ªãa ch·ªâ ƒë√£ ch·ªçn:</p>
                                                            <p className="text-white text-sm">{formData.address}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-end gap-3 pt-6 mt-6 border-t border-slate-700">
                                        <button
                                            type="button"
                                            onClick={() => setShowModal(false)}
                                            className="px-5 py-2.5 rounded-lg text-gray-300 hover:bg-slate-700 transition-colors"
                                        >
                                            H·ªßy
                                        </button>
                                        <button
                                            type="submit"
                                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium flex items-center gap-2"
                                        >
                                            <Icon name={editingLocation ? 'Check' : 'Plus'} size={18} />
                                            {editingLocation ? 'C·∫≠p nh·∫≠t ƒë·ªãa ƒëi·ªÉm' : 'Th√™m ƒë·ªãa ƒëi·ªÉm'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ===================== USERS MANAGEMENT (SUPER_ADMIN only) =====================
        const UsersPage = ({ user }) => {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [editingUser, setEditingUser] = useState(null);
            const [formData, setFormData] = useState({
                username: '',
                password: '',
                fullName: '',
                email: '',
                role: 'EDITOR'
            });
            
            const fetchData = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/users`);
                    if (response.ok) {
                        const data = await response.json();
                        setUsers(data);
                    }
                } catch (err) {
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };
            
            useEffect(() => {
                fetchData();
            }, []);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                const url = editingUser 
                    ? `${API_BASE_URL}/users/${editingUser.id}`
                    : `${API_BASE_URL}/users`;
                    
                const method = editingUser ? 'PUT' : 'POST';
                
                const payload = editingUser 
                    ? { fullName: formData.fullName, email: formData.email, role: formData.role }
                    : formData;
                
                try {
                    const response = await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.ok) {
                        setShowModal(false);
                        setEditingUser(null);
                        setFormData({
                            username: '',
                            password: '',
                            fullName: '',
                            email: '',
                            role: 'EDITOR'
                        });
                        fetchData();
                    } else {
                        const error = await response.json();
                        alert(error.message || 'C√≥ l·ªói x·∫£y ra');
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            const handleEdit = (u) => {
                setEditingUser(u);
                setFormData({
                    username: u.username || '',
                    password: '',
                    fullName: u.fullName || '',
                    email: u.email || '',
                    role: u.role || 'EDITOR'
                });
                setShowModal(true);
            };
            
            const handleToggleActive = async (id) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/users/${id}/toggle-active`, {
                        method: 'PUT'
                    });
                    
                    if (response.ok) {
                        fetchData();
                    } else {
                        const error = await response.json();
                        alert(error.message || 'C√≥ l·ªói x·∫£y ra');
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            const handleDelete = async (id) => {
                if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?')) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/users/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        fetchData();
                    } else {
                        const error = await response.json();
                        alert(error.message || 'C√≥ l·ªói x·∫£y ra');
                    }
                } catch (err) {
                    console.error('Error:', err);
                }
            };
            
            const roleColors = {
                'SUPER_ADMIN': 'bg-purple-500/20 text-purple-400',
                'ADMIN': 'bg-blue-500/20 text-blue-400',
                'EDITOR': 'bg-green-500/20 text-green-400'
            };
            
            const roleLabels = {
                'SUPER_ADMIN': 'Qu·∫£n tr·ªã cao c·∫•p',
                'ADMIN': 'Qu·∫£n tr·ªã vi√™n',
                'EDITOR': 'Bi√™n t·∫≠p vi√™n'
            };
            
            return (
                <div className="animate-slide-in">
                    <div className="flex items-center justify-between mb-6">
                        <div>
                            <h1 className="text-2xl font-bold text-white mb-1">Qu·∫£n l√Ω t√†i kho·∫£n</h1>
                            <p className="text-gray-400 text-sm">Th√™m v√† ph√¢n quy·ªÅn t√†i kho·∫£n ng∆∞·ªùi d√πng</p>
                        </div>
                        <button
                            onClick={() => {
                                setEditingUser(null);
                                setFormData({
                                    username: '',
                                    password: '',
                                    fullName: '',
                                    email: '',
                                    role: 'EDITOR'
                                });
                                setShowModal(true);
                            }}
                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium flex items-center gap-2"
                        >
                            <Icon name="UserPlus" size={18} />
                            Th√™m t√†i kho·∫£n
                        </button>
                    </div>
                    
                    {/* Users Table */}
                    <div className="bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 overflow-hidden">
                        {loading ? (
                            <div className="text-gray-400 text-center py-12">ƒêang t·∫£i...</div>
                        ) : users.length === 0 ? (
                            <div className="text-gray-400 text-center py-12">
                                <Icon name="Users" size={48} className="mx-auto mb-4 opacity-50" />
                                <p>Ch∆∞a c√≥ t√†i kho·∫£n n√†o</p>
                            </div>
                        ) : (
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b border-slate-700/50 text-left">
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">T√†i kho·∫£n</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">H·ªç t√™n</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm">Email</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-center">Vai tr√≤</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-center">Tr·∫°ng th√°i</th>
                                        <th className="px-5 py-4 text-gray-400 font-medium text-sm text-right">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {users.map((u, idx) => (
                                        <tr key={idx} className="table-row border-b border-slate-700/30">
                                            <td className="px-5 py-4">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center">
                                                        <span className="text-white font-medium text-sm">
                                                            {u.username?.charAt(0).toUpperCase()}
                                                        </span>
                                                    </div>
                                                    <span className="text-white font-medium">{u.username}</span>
                                                </div>
                                            </td>
                                            <td className="px-5 py-4 text-gray-300">{u.fullName || '-'}</td>
                                            <td className="px-5 py-4 text-gray-300">{u.email || '-'}</td>
                                            <td className="px-5 py-4 text-center">
                                                <span className={`px-2 py-1 rounded text-xs ${roleColors[u.role]}`}>
                                                    {roleLabels[u.role] || u.role}
                                                </span>
                                            </td>
                                            <td className="px-5 py-4 text-center">
                                                <span className={`px-2 py-1 rounded text-xs ${u.isActive ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                                    {u.isActive ? 'Ho·∫°t ƒë·ªông' : 'ƒê√£ kh√≥a'}
                                                </span>
                                            </td>
                                            <td className="px-5 py-4 text-right">
                                                <div className="flex items-center justify-end gap-2">
                                                    <button
                                                        onClick={() => handleEdit(u)}
                                                        className="p-2 hover:bg-blue-500/20 text-blue-400 rounded-lg transition-colors"
                                                        title="S·ª≠a"
                                                    >
                                                        <Icon name="Edit2" size={16} />
                                                    </button>
                                                    {u.id !== user?.id && (
                                                        <>
                                                            <button
                                                                onClick={() => handleToggleActive(u.id)}
                                                                className={`p-2 rounded-lg transition-colors ${u.isActive ? 'hover:bg-yellow-500/20 text-yellow-400' : 'hover:bg-green-500/20 text-green-400'}`}
                                                                title={u.isActive ? 'Kh√≥a t√†i kho·∫£n' : 'M·ªü kh√≥a'}
                                                            >
                                                                <Icon name={u.isActive ? 'Lock' : 'Unlock'} size={16} />
                                                            </button>
                                                            <button
                                                                onClick={() => handleDelete(u.id)}
                                                                className="p-2 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors"
                                                                title="X√≥a"
                                                            >
                                                                <Icon name="Trash2" size={16} />
                                                            </button>
                                                        </>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>
                    
                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-2xl w-full max-w-lg border border-slate-700">
                                <div className="p-6 border-b border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-white">
                                            {editingUser ? 'S·ª≠a t√†i kho·∫£n' : 'Th√™m t√†i kho·∫£n m·ªõi'}
                                        </h2>
                                        <button
                                            onClick={() => setShowModal(false)}
                                            className="p-2 hover:bg-slate-700 rounded-lg transition-colors text-gray-400"
                                        >
                                            <Icon name="X" size={20} />
                                        </button>
                                    </div>
                                </div>
                                
                                <form onSubmit={handleSubmit} className="p-6 space-y-5">
                                    {!editingUser && (
                                        <>
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">T√™n ƒëƒÉng nh·∫≠p *</label>
                                                <input
                                                    type="text"
                                                    value={formData.username}
                                                    onChange={(e) => setFormData({...formData, username: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-gray-300 text-sm font-medium mb-2">M·∫≠t kh·∫©u *</label>
                                                <input
                                                    type="password"
                                                    value={formData.password}
                                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                                    className="input-field w-full px-4 py-3 rounded-lg text-white"
                                                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                                                    required
                                                />
                                            </div>
                                        </>
                                    )}
                                    
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">H·ªç t√™n</label>
                                        <input
                                            type="text"
                                            value={formData.fullName}
                                            onChange={(e) => setFormData({...formData, fullName: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">Email</label>
                                        <input
                                            type="email"
                                            value={formData.email}
                                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            placeholder="email@example.com"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-gray-300 text-sm font-medium mb-2">Vai tr√≤ *</label>
                                        <select
                                            value={formData.role}
                                            onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            className="input-field w-full px-4 py-3 rounded-lg text-white"
                                            required
                                        >
                                            <option value="EDITOR" className="bg-slate-800 text-white">Bi√™n t·∫≠p vi√™n</option>
                                            <option value="ADMIN" className="bg-slate-800 text-white">Qu·∫£n tr·ªã vi√™n</option>
                                            <option value="SUPER_ADMIN" className="bg-slate-800 text-white">Qu·∫£n tr·ªã cao c·∫•p</option>
                                        </select>
                                        <p className="mt-2 text-gray-500 text-xs">
                                            ‚Ä¢ Bi√™n t·∫≠p vi√™n: Th√™m/s·ª≠a b√†i vi·∫øt v√† ƒë·ªãa ƒëi·ªÉm<br/>
                                            ‚Ä¢ Qu·∫£n tr·ªã vi√™n: To√†n quy·ªÅn qu·∫£n l√Ω n·ªôi dung<br/>
                                            ‚Ä¢ Qu·∫£n tr·ªã cao c·∫•p: To√†n quy·ªÅn + qu·∫£n l√Ω t√†i kho·∫£n
                                        </p>
                                    </div>
                                    
                                    <div className="flex justify-end gap-3 pt-4">
                                        <button
                                            type="button"
                                            onClick={() => setShowModal(false)}
                                            className="px-5 py-2.5 rounded-lg text-gray-300 hover:bg-slate-700 transition-colors"
                                        >
                                            H·ªßy
                                        </button>
                                        <button
                                            type="submit"
                                            className="btn-primary px-5 py-2.5 rounded-lg text-white font-medium"
                                        >
                                            {editingUser ? 'C·∫≠p nh·∫≠t' : 'T·∫°o t√†i kho·∫£n'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ===================== MAIN ADMIN APP =====================
        const AdminApp = () => {
            const [user, setUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [loading, setLoading] = useState(true);
            
            // Check auth on mount
            useEffect(() => {
                const checkAuth = async () => {
                    // Check localStorage first
                    const storedUser = localStorage.getItem('user');
                    if (storedUser) {
                        try {
                            const response = await fetch(`${API_BASE_URL}/auth/check`);
                            const data = await response.json();
                            
                            if (data.authenticated) {
                                setUser(data.user);
                            } else {
                                localStorage.removeItem('user');
                            }
                        } catch (err) {
                            // If API fails, still use stored user for demo
                            setUser(JSON.parse(storedUser));
                        }
                    }
                    setLoading(false);
                };
                
                checkAuth();
            }, []);
            
            const handleLogin = (userData) => {
                setUser(userData);
            };
            
            const handleLogout = async () => {
                try {
                    await fetch(`${API_BASE_URL}/auth/logout`, { method: 'POST' });
                } catch (err) {
                    console.error('Logout error:', err);
                }
                localStorage.removeItem('user');
                setUser(null);
            };
            
            // Render page based on current selection
            const renderPage = () => {
                switch (currentPage) {
                    case 'dashboard':
                        return <DashboardPage user={user} />;
                    case 'posts':
                        return <PostsPage user={user} />;
                    case 'locations':
                        return <LocationsPage user={user} />;
                    case 'users':
                        return <UsersPage user={user} />;
                    default:
                        return <DashboardPage user={user} />;
                }
            };
            
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="w-12 h-12 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin" />
                    </div>
                );
            }
            
            if (!user) {
                return <LoginPage onLogin={handleLogin} />;
            }
            
            return (
                <div className="min-h-screen flex">
                    <Sidebar 
                        currentPage={currentPage} 
                        onNavigate={setCurrentPage}
                        user={user}
                        onLogout={handleLogout}
                    />
                    <main className="flex-1 ml-64 p-8">
                        {renderPage()}
                    </main>
                </div>
            );
        };
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>
